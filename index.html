<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlpinCodeID - DestructiveDb</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
 <style>
 :root {
    --primary-color: #00f0ff;
    --secondary-color: #ff00aa;
    --dark-color: #0a0a20;
    --darker-color: #050510;
    --light-color: #e0e0ff;
    --error-color: #ff3860;
    --success-color: #09c372;
    --warning-color: #ffdd57;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Montserrat', sans-serif;
    background-color: var(--dark-color);
    color: var(--light-color);
    line-height: 1.6;
    overflow-x: hidden;
    background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 240, 255, 0.05) 0%, transparent 20%),
        radial-gradient(circle at 90% 80%, rgba(255, 0, 170, 0.05) 0%, transparent 20%);
}

.container {
    width: 100%;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.hidden {
    display: none !important;
}

/* Login Page Styles */
.login-box {
    position: relative;
    width: 100%;
    max-width: 400px;
    background-color: rgba(10, 10, 32, 0.8);
    border: 1px solid var(--primary-color);
    border-radius: 8px;
    padding: 40px 30px;
    box-shadow: 0 0 20px rgba(0, 240, 255, 0.2),
                0 0 40px rgba(255, 0, 170, 0.1);
    backdrop-filter: blur(5px);
    overflow: hidden;
}

.logo {
    text-align: center;
    margin-bottom: 30px;
}

.logo h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 5px;
    letter-spacing: 2px;
}

.logo h2 {
    font-size: 1.2rem;
    font-weight: 400;
    color: var(--primary-color);
    letter-spacing: 3px;
}

.alpin {
    color: var(--primary-color);
}

.code {
    color: var(--light-color);
}

.id {
    color: var(--secondary-color);
}

.input-group {
    position: relative;
    margin-bottom: 20px;
}

.input-group i {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary-color);
}

.input-group input {
    width: 100%;
    padding: 12px 15px 12px 40px;
    background-color: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(0, 240, 255, 0.3);
    border-radius: 4px;
    color: var(--light-color);
    font-size: 1rem;
    transition: all 0.3s ease;
}

.input-group input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 10px rgba(0, 240, 255, 0.3);
}

.login-btn {
    width: 100%;
    padding: 12px;
    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
    border: none;
    border-radius: 4px;
    color: var(--dark-color);
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 240, 255, 0.4);
}

.error-message {
    color: var(--error-color);
    font-size: 0.9rem;
    margin-top: 10px;
    text-align: center;
}

.cyber-decoration {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: 
        linear-gradient(90deg, transparent 49%, var(--primary-color) 49%, transparent 51%),
        linear-gradient(0deg, transparent 49%, var(--primary-color) 49%, transparent 51%);
    background-size: 20px 20px;
    opacity: 0.05;
    pointer-events: none;
    z-index: -1;
}

/* Dashboard Styles */
.dashboard-header {
    width: 100%;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 0;
    margin-bottom: 30px;
    border-bottom: 1px solid rgba(0, 240, 255, 0.3);
}

.dashboard-header h1 {
    font-family: 'Orbitron', sans-serif;
    font-size: 1.8rem;
}

.dashboard-title {
    color: var(--primary-color);
    font-family: 'Montserrat', sans-serif;
    font-weight: 600;
}

.logout-btn {
    background: rgba(255, 0, 170, 0.2);
    border: 1px solid var(--secondary-color);
    color: var(--light-color);
    padding: 8px 15px;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.logout-btn:hover {
    background: rgba(255, 0, 170, 0.4);
}

.dashboard-content {
    width: 100%;
    max-width: 1200px;
}

.admin-section, .number-management, .user-section {
    background-color: rgba(10, 10, 32, 0.6);
    border: 1px solid rgba(0, 240, 255, 0.2);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
    box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
}

.admin-section h2, .number-management h2, .user-section h2 {
    color: var(--primary-color);
    margin-bottom: 20px;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    gap: 10px;
}

.create-account-form, .add-number-form {
    margin-bottom: 30px;
}

.create-account-form h3, .add-number-form h3 {
    color: var(--light-color);
    margin-bottom: 15px;
    font-size: 1.2rem;
}

.create-account-form form, .add-number-form form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.create-account-form input, 
.create-account-form select,
.add-number-form input,
.add-number-form textarea,
.add-number-form select {
    padding: 10px 15px;
    background-color: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(0, 240, 255, 0.3);
    border-radius: 4px;
    color: var(--light-color);
    font-size: 1rem;
}

.add-number-form textarea {
    grid-column: span 2;
    min-height: 100px;
    resize: vertical;
}

.action-btn {
    background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
    border: none;
    border-radius: 4px;
    color: var(--dark-color);
    padding: 10px 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    grid-column: span 2;
}

.action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 240, 255, 0.4);
}

.database-status {
    margin-bottom: 20px;
    padding: 15px;
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 4px;
}

.database-status p {
    margin-bottom: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th, td {
    padding: 12px 15px;
    text-align: left;
    border-bottom: 1px solid rgba(0, 240, 255, 0.1);
}

th {
    background-color: rgba(0, 240, 255, 0.1);
    color: var(--primary-color);
    font-weight: 600;
}

tr:hover {
    background-color: rgba(0, 240, 255, 0.05);
}

.user-info {
    display: flex;
    align-items: center;
    gap: 15px;
}

.user-message {
    background-color: rgba(0, 240, 255, 0.1);
    padding: 15px;
    border-radius: 4px;
    margin-bottom: 20px;
}

.user-message p {
    margin-bottom: 10px;
}

.user-message p:last-child {
    margin-bottom: 0;
}

/* Responsive Styles */
@media (max-width: 768px) {
    .login-box {
        padding: 30px 20px;
    }
    
    .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .create-account-form form, .add-number-form form {
        grid-template-columns: 1fr;
    }
    
    .add-number-form textarea {
        grid-column: span 1;
    }
    
    .action-btn {
        grid-column: span 1;
    }
    
    th, td {
        padding: 8px 10px;
        font-size: 0.9rem;
    }
}

/* Animations */
@keyframes pulse {
    0% { opacity: 0.6; }
    50% { opacity: 1; }
    100% { opacity: 0.6; }
}

.pulse {
    animation: pulse 2s infinite;
}
 </style>
</head>
<body>
    <div id="login-container" class="container">
        <div class="login-box">
            <div class="logo">
                <h1><span class="alpin">Alpin</span><span class="code">Code</span><span class="id">ID</span></h1>
                <h2>DestructiveDb</h2>
            </div>
            <form id="login-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="username" placeholder="Username" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="password" placeholder="Password" required>
                </div>
                <button type="submit" class="login-btn">LOGIN</button>
                <p id="login-error" class="error-message"></p>
            </form>
            <div class="cyber-decoration"></div>
        </div>
    </div>

    <div id="admin-dashboard" class="container hidden">
        <header class="dashboard-header">
            <h1><span class="alpin">Alpin</span><span class="code">Code</span><span class="id">ID</span> <span class="dashboard-title">Admin Dashboard</span></h1>
            <button id="logout-btn" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </header>
        
        <div class="dashboard-content">
            <div class="admin-section">
                <h2><i class="fas fa-users-cog"></i> Account Management</h2>
                <div class="create-account-form">
                    <h3>Create New User</h3>
                    <form id="create-account-form">
                        <input type="text" id="new-username" placeholder="Username" required>
                        <input type="password" id="new-password" placeholder="Password" required>
                        <select id="account-type" required>
                            <option value="user">Regular User</option>
                            <option value="admin">Admin</option>
                        </select>
                        <select id="expiry-type" required>
                            <option value="permanent">Permanent</option>
                            <option value="temporary">Temporary</option>
                        </select>
                        <div id="expiry-duration-container" class="hidden">
                            <input type="number" id="expiry-duration" placeholder="Duration">
                            <select id="expiry-unit">
                                <option value="hours">Hours</option>
                                <option value="days">Days</option>
                            </select>
                        </div>
                        <button type="submit" class="action-btn">Create Account</button>
                    </form>
                </div>
                
                <div class="user-list">
                    <h3>Active Users</h3>
                    <table id="users-table">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Account Type</th>
                                <th>Expiry Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="users-list-body">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="number-management">
                <h2><i class="fas fa-database"></i> Number Database</h2>
                <div class="add-number-form">
                    <h3>Add New Number</h3>
                    <form id="add-number-form">
                        <input type="text" id="phone-number" placeholder="Phone Number" required>
                        <textarea id="number-notes" placeholder="Additional notes"></textarea>
                        <button type="submit" class="action-btn">Add to Database</button>
                    </form>
                </div>
                
                <div class="database-status">
                    <h3>Database Status</h3>
                    <p>GitHub File: <span id="github-file-link">https://github.com/ALxyz572/Alpin/blob/main/destructivedb.json</span></p>
                    <p>Last Updated: <span id="last-updated">-</span></p>
                    <button id="refresh-db-btn" class="action-btn"><i class="fas fa-sync-alt"></i> Refresh Data</button>
                </div>
                
                <div class="numbers-list">
                    <h3>Current Numbers</h3>
                    <table id="numbers-table">
                        <thead>
                            <tr>
                                <th>Number</th>
                                <th>Added By</th>
                                <th>Date Added</th>
                                <th>Notes</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="numbers-list-body">
                            <!-- Numbers will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="user-dashboard" class="container hidden">
        <header class="dashboard-header">
            <h1><span class="alpin">Alpin</span><span class="code">Code</span><span class="id">ID</span> <span class="dashboard-title">User Dashboard</span></h1>
            <div class="user-info">
                <span id="user-account-name"></span>
                <span id="account-expiry"></span>
                <button id="user-logout-btn" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </div>
        </header>
        
        <div class="dashboard-content">
            <div class="user-section">
                <h2><i class="fas fa-database"></i> Number Database</h2>
                <div class="user-message">
                    <p>Welcome to AlpinCodeID DestructiveDb. You can add numbers to our database below.</p>
                    <p>Your account expires: <strong id="user-expiry-display"></strong></p>
                </div>
                
                <div class="add-number-form">
                    <h3>Add New Number</h3>
                    <form id="user-add-number-form">
                        <input type="text" id="user-phone-number" placeholder="Phone Number" required>
                        <textarea id="user-number-notes" placeholder="Additional notes"></textarea>
                        <button type="submit" class="action-btn">Add to Database</button>
                    </form>
                </div>
                
                <div class="database-status">
                    <h3>Database Status</h3>
                    <p>GitHub File: <span id="user-github-file-link">https://github.com/ALxyz572/Alpin/blob/main/destructivedb.json</span></p>
                    <p>Last Updated: <span id="user-last-updated">-</span></p>
                    <button id="user-refresh-db-btn" class="action-btn"><i class="fas fa-sync-alt"></i> Refresh Data</button>
                </div>
                
                <div class="numbers-list">
                    <h3>Current Numbers</h3>
                    <table id="user-numbers-table">
                        <thead>
                            <tr>
                                <th>Number</th>
                                <th>Added By</th>
                                <th>Date Added</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="user-numbers-list-body">
                            <!-- Numbers will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

<script>
// GitHub configuration
const GITHUB_USERNAME = 'ALxyz572';
const GITHUB_REPO = 'Alpin';
const GITHUB_BRANCH = 'main';
const GITHUB_FILE_PATH = 'destructivedb.json';
const GITHUB_TOKEN = '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'; // Replace with your GitHub token

// API endpoints
const GITHUB_API_URL = `https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${GITHUB_FILE_PATH}`;
const GITHUB_RAW_URL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_REPO}/${GITHUB_BRANCH}/${GITHUB_FILE_PATH}`;

// DOM Elements
const loginContainer = document.getElementById('login-container');
const loginForm = document.getElementById('login-form');
const loginError = document.getElementById('login-error');
const adminDashboard = document.getElementById('admin-dashboard');
const userDashboard = document.getElementById('user-dashboard');
const logoutBtn = document.getElementById('logout-btn');
const userLogoutBtn = document.getElementById('user-logout-btn');

// Admin elements
const createAccountForm = document.getElementById('create-account-form');
const usersListBody = document.getElementById('users-list-body');
const addNumberForm = document.getElementById('add-number-form');
const numbersListBody = document.getElementById('numbers-list-body');
const refreshDbBtn = document.getElementById('refresh-db-btn');
const expiryTypeSelect = document.getElementById('expiry-type');
const expiryDurationContainer = document.getElementById('expiry-duration-container');

// User elements
const userAddNumberForm = document.getElementById('user-add-number-form');
const userNumbersListBody = document.getElementById('user-numbers-list-body');
const userRefreshDbBtn = document.getElementById('user-refresh-db-btn');
const userAccountName = document.getElementById('user-account-name');
const userExpiryDisplay = document.getElementById('user-expiry-display');
const accountExpiry = document.getElementById('account-expiry');

// App state
let currentUser = null;
let database = [];
let users = [];

// Default admin account
const defaultAdmin = {
    username: 'AlpinCodeID',
    password: 'AlpinCodeID123',
    accountType: 'admin',
    expiryDate: 'permanent',
    createdAt: new Date().toISOString()
};

// Initialize the app
function init() {
    // Check for existing session
    const session = localStorage.getItem('alpinCodeIdSession');
    if (session) {
        const parsedSession = JSON.parse(session);
        if (new Date(parsedSession.expiry) > new Date()) {
            currentUser = parsedSession;
            loadDashboard();
        } else {
            localStorage.removeItem('alpinCodeIdSession');
        }
    }
    
    // Event listeners
    loginForm.addEventListener('submit', handleLogin);
    logoutBtn.addEventListener('click', handleLogout);
    userLogoutBtn.addEventListener('click', handleLogout);
    
    expiryTypeSelect.addEventListener('change', toggleExpiryFields);
    createAccountForm.addEventListener('submit', handleCreateAccount);
    addNumberForm.addEventListener('submit', handleAddNumber);
    refreshDbBtn.addEventListener('click', fetchDatabase);
    userAddNumberForm.addEventListener('submit', handleUserAddNumber);
    userRefreshDbBtn.addEventListener('click', fetchDatabase);
    
    // Initialize with default admin if no users exist
    if (!localStorage.getItem('alpinCodeIdUsers')) {
        users = [defaultAdmin];
        localStorage.setItem('alpinCodeIdUsers', JSON.stringify(users));
    } else {
        users = JSON.parse(localStorage.getItem('alpinCodeIdUsers'));
    }
    
    // Fetch database on admin/user dashboard load
    fetchDatabase();
}

// Toggle expiry duration fields based on account type
function toggleExpiryFields() {
    if (expiryTypeSelect.value === 'temporary') {
        expiryDurationContainer.classList.remove('hidden');
    } else {
        expiryDurationContainer.classList.add('hidden');
    }
}

// Handle login
function handleLogin(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    // Find user
    const user = users.find(u => u.username === username && u.password === password);
    
    if (user) {
        // Check if account is expired
        if (user.expiryDate !== 'permanent' && new Date(user.expiryDate) < new Date()) {
            loginError.textContent = 'Account has expired. Please contact admin.';
            return;
        }
        
        // Set current user and session
        currentUser = user;
        
        // Set session expiry
        const sessionExpiry = new Date();
        sessionExpiry.setHours(sessionExpiry.getHours() + 12); // 12 hour session
        
        localStorage.setItem('alpinCodeIdSession', JSON.stringify({
            ...user,
            sessionExpiry: sessionExpiry.toISOString()
        }));
        
        loadDashboard();
    } else {
        loginError.textContent = 'Invalid username or password';
    }
}

// Load appropriate dashboard
function loadDashboard() {
    loginContainer.classList.add('hidden');
    
    if (currentUser.accountType === 'admin') {
        adminDashboard.classList.remove('hidden');
        userDashboard.classList.add('hidden');
        loadAdminDashboard();
    } else {
        adminDashboard.classList.add('hidden');
        userDashboard.classList.remove('hidden');
        loadUserDashboard();
    }
}

// Load admin dashboard
function loadAdminDashboard() {
    // Load users list
    renderUsersList();
    
    // Load numbers list
    renderNumbersList();
}

// Load user dashboard
function loadUserDashboard() {
    // Set user info
    userAccountName.textContent = currentUser.username;
    
    // Set expiry info
    if (currentUser.expiryDate === 'permanent') {
        userExpiryDisplay.textContent = 'Permanent';
        accountExpiry.textContent = 'Permanent Account';
    } else {
        const expiryDate = new Date(currentUser.expiryDate);
        userExpiryDisplay.textContent = expiryDate.toLocaleString();
        accountExpiry.textContent = `Expires: ${expiryDate.toLocaleString()}`;
    }
    
    // Load numbers list
    renderNumbersList();
}

// Handle logout
function handleLogout() {
    currentUser = null;
    localStorage.removeItem('alpinCodeIdSession');
    loginContainer.classList.remove('hidden');
    adminDashboard.classList.add('hidden');
    userDashboard.classList.add('hidden');
    
    // Clear form fields
    loginForm.reset();
    loginError.textContent = '';
}

// Handle create account
function handleCreateAccount(e) {
    e.preventDefault();
    
    const username = document.getElementById('new-username').value;
    const password = document.getElementById('new-password').value;
    const accountType = document.getElementById('account-type').value;
    const expiryType = document.getElementById('expiry-type').value;
    
    // Check if username already exists
    if (users.some(u => u.username === username)) {
        alert('Username already exists');
        return;
    }
    
    // Calculate expiry date
    let expiryDate;
    if (expiryType === 'permanent') {
        expiryDate = 'permanent';
    } else {
        const duration = parseInt(document.getElementById('expiry-duration').value);
        const unit = document.getElementById('expiry-unit').value;
        
        if (isNaN(duration) || duration <= 0) {
            alert('Please enter a valid duration');
            return;
        }
        
        const expiry = new Date();
        if (unit === 'hours') {
            expiry.setHours(expiry.getHours() + duration);
        } else {
            expiry.setDate(expiry.getDate() + duration);
        }
        
        expiryDate = expiry.toISOString();
    }
    
    // Create new user
    const newUser = {
        username,
        password,
        accountType,
        expiryDate,
        createdAt: new Date().toISOString(),
        createdBy: currentUser.username
    };
    
    users.push(newUser);
    localStorage.setItem('alpinCodeIdUsers', JSON.stringify(users));
    
    // Reset form and refresh list
    createAccountForm.reset();
    expiryDurationContainer.classList.add('hidden');
    renderUsersList();
    
    alert('Account created successfully');
}

// Render users list
function renderUsersList() {
    usersListBody.innerHTML = '';
    
    users.forEach(user => {
        const row = document.createElement('tr');
        
        // Username
        const usernameCell = document.createElement('td');
        usernameCell.textContent = user.username;
        if (user.accountType === 'admin') {
            usernameCell.innerHTML += ' <span class="badge">Admin</span>';
        }
        row.appendChild(usernameCell);
        
        // Account Type
        const typeCell = document.createElement('td');
        typeCell.textContent = user.accountType;
        row.appendChild(typeCell);
        
        // Expiry Date
        const expiryCell = document.createElement('td');
        if (user.expiryDate === 'permanent') {
            expiryCell.textContent = 'Permanent';
        } else {
            const expiryDate = new Date(user.expiryDate);
            expiryCell.textContent = expiryDate.toLocaleString();
            
            if (expiryDate < new Date()) {
                expiryCell.innerHTML += ' <span class="badge expired">Expired</span>';
            }
        }
        row.appendChild(expiryCell);
        
        // Actions
        const actionsCell = document.createElement('td');
        if (user.username !== currentUser.username) {
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.className = 'action-btn small';
            deleteBtn.addEventListener('click', () => deleteUser(user.username));
            actionsCell.appendChild(deleteBtn);
        }
        row.appendChild(actionsCell);
        
        usersListBody.appendChild(row);
    });
}

// Delete user
function deleteUser(username) {
    if (confirm(`Are you sure you want to delete user ${username}?`)) {
        users = users.filter(u => u.username !== username);
        localStorage.setItem('alpinCodeIdUsers', JSON.stringify(users));
        renderUsersList();
    }
}

// Fetch database from GitHub
async function fetchDatabase() {
    try {
        const response = await fetch(GITHUB_RAW_URL + `?t=${Date.now()}`);
        
        if (response.ok) {
            const data = await response.json();
            database = data;
            renderNumbersList();
            
            // Update last updated time
            const lastUpdatedElements = document.querySelectorAll('#last-updated, #user-last-updated');
            lastUpdatedElements.forEach(el => {
                el.textContent = new Date().toLocaleString();
            });
            
            return true;
        } else {
            throw new Error('Failed to fetch database');
        }
    } catch (error) {
        console.error('Error fetching database:', error);
        alert('Failed to fetch database. Please try again.');
        return false;
    }
}

// Render numbers list
function renderNumbersList() {
    numbersListBody.innerHTML = '';
    userNumbersListBody.innerHTML = '';
    
    if (database.length === 0) {
        const emptyRow = document.createElement('tr');
        const emptyCell = document.createElement('td');
        emptyCell.colSpan = currentUser.accountType === 'admin' ? 5 : 4;
        emptyCell.textContent = 'No numbers in database';
        emptyCell.className = 'empty-message';
        emptyRow.appendChild(emptyCell);
        numbersListBody.appendChild(emptyRow);
        userNumbersListBody.appendChild(emptyRow.cloneNode(true));
        return;
    }
    
    database.forEach(number => {
        // Admin table row
        if (currentUser.accountType === 'admin') {
            const adminRow = document.createElement('tr');
            
            // Number
            const numberCell = document.createElement('td');
            numberCell.textContent = number.number;
            adminRow.appendChild(numberCell);
            
            // Added By
            const addedByCell = document.createElement('td');
            addedByCell.textContent = number.addedBy || 'Unknown';
            adminRow.appendChild(addedByCell);
            
            // Date Added
            const dateCell = document.createElement('td');
            dateCell.textContent = new Date(number.dateAdded).toLocaleString();
            adminRow.appendChild(dateCell);
            
            // Notes
            const notesCell = document.createElement('td');
            notesCell.textContent = number.notes || '-';
            adminRow.appendChild(notesCell);
            
            // Actions
            const actionsCell = document.createElement('td');
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.className = 'action-btn small';
            deleteBtn.addEventListener('click', () => deleteNumber(number.number));
            actionsCell.appendChild(deleteBtn);
            adminRow.appendChild(actionsCell);
            
            numbersListBody.appendChild(adminRow);
        }
        
        // User table row
        const userRow = document.createElement('tr');
        
        // Number
        const userNumberCell = document.createElement('td');
        userNumberCell.textContent = number.number;
        userRow.appendChild(userNumberCell);
        
        // Added By
        const userAddedByCell = document.createElement('td');
        userAddedByCell.textContent = number.addedBy || 'Unknown';
        userRow.appendChild(userAddedByCell);
        
        // Date Added
        const userDateCell = document.createElement('td');
        userDateCell.textContent = new Date(number.dateAdded).toLocaleString();
        userRow.appendChild(userDateCell);
        
        // Notes
        const userNotesCell = document.createElement('td');
        userNotesCell.textContent = number.notes || '-';
        userRow.appendChild(userNotesCell);
        
        userNumbersListBody.appendChild(userRow);
    });
}

// Handle add number (admin)
async function handleAddNumber(e) {
    e.preventDefault();
    
    const number = document.getElementById('phone-number').value;
    const notes = document.getElementById('number-notes').value;
    
    await addNumberToDatabase(number, notes);
}

// Handle add number (user)
async function handleUserAddNumber(e) {
    e.preventDefault();
    
    const number = document.getElementById('user-phone-number').value;
    const notes = document.getElementById('user-number-notes').value;
    
    await addNumberToDatabase(number, notes);
    
    // Clear form
    document.getElementById('user-phone-number').value = '';
    document.getElementById('user-number-notes').value = '';
}

// Add number to database
async function addNumberToDatabase(number, notes) {
    // Check if number already exists
    if (database.some(n => n.number === number)) {
        alert('This number already exists in the database');
        return;
    }
    
    // Create new number entry
    const newNumber = {
        number,
        addedBy: currentUser.username,
        dateAdded: new Date().toISOString(),
        notes: notes || ''
    };
    
    // Add to local database
    database.unshift(newNumber);
    
    try {
        // Get current file SHA (needed for update)
        const fileInfo = await getFileInfo();
        
        // Update file on GitHub
        const updated = await updateGitHubFile(fileInfo.sha, database);
        
        if (updated) {
            // Refresh the list
            renderNumbersList();
            
            // Clear form (admin)
            if (currentUser.accountType === 'admin') {
                document.getElementById('phone-number').value = '';
                document.getElementById('number-notes').value = '';
            }
            
            alert('Number added successfully');
        } else {
            // Revert local change if GitHub update failed
            database = database.filter(n => n.number !== number);
            alert('Failed to add number. Please try again.');
        }
    } catch (error) {
        console.error('Error adding number:', error);
        database = database.filter(n => n.number !== number);
        alert('An error occurred. Please try again.');
    }
}

// Delete number
async function deleteNumber(number) {
    if (confirm(`Are you sure you want to delete number ${number}?`)) {
        // Remove from local database
        const originalLength = database.length;
        database = database.filter(n => n.number !== number);
        
        if (database.length === originalLength) {
            alert('Number not found');
            return;
        }
        
        try {
            // Get current file SHA
            const fileInfo = await getFileInfo();
            
            // Update file on GitHub
            const updated = await updateGitHubFile(fileInfo.sha, database);
            
            if (!updated) {
                // Revert if update failed
                database = [...database, { number }];
                alert('Failed to delete number. Please try again.');
            } else {
                renderNumbersList();
            }
        } catch (error) {
            console.error('Error deleting number:', error);
            database = [...database, { number }];
            alert('An error occurred. Please try again.');
        }
    }
}

// Get file info from GitHub
async function getFileInfo() {
    const response = await fetch(GITHUB_API_URL, {
        headers: {
            'Authorization': `token ${GITHUB_TOKEN}`,
            'Accept': 'application/vnd.github.v3+json'
        }
    });
    
    if (!response.ok) {
        throw new Error('Failed to get file info');
    }
    
    return await response.json();
}

// Update file on GitHub
async function updateGitHubFile(sha, content) {
    const response = await fetch(GITHUB_API_URL, {
        method: 'PUT',
        headers: {
            'Authorization': `token ${GITHUB_TOKEN}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            message: `Update database - ${new Date().toLocaleString()}`,
            content: btoa(JSON.stringify(content, null, 2)),
            sha: sha,
            branch: GITHUB_BRANCH
        })
    });
    
    return response.ok;
}

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
